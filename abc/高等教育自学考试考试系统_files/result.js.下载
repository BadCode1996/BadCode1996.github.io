(function($,win){
	$.ajaxSetup({cache: false});
	function ExamObj(userExamId,basePath,allowSeeAnswer,confuseOrder){		
		this.userExamId=userExamId;	
		this.basePath=basePath;
		this.allowSeeAnswer=allowSeeAnswer;
		this.confuseOrder=confuseOrder;
	}
	ExamObj.prototype.getUserExamId=function(){
		return this.userExamId;
	}
	ExamObj.prototype.Init=function(client){
		var self=this;
		self.client=client;
		$(document).ajaxError(function(event, jqXHR, ajaxSettings, thrownError){/*对ajax发生错误的处理*/
			 var msg='抱歉！当前操作失败，请检查您的网络。点击<a href="'+window.location+'">这里</a>刷新。';
			 self.Message(msg, 'err');
		});
		$.get(self.basePath+'/myanswer/list/'+self.userExamId,{},function(data){			
			if(data&&data.success){
				var userAnswers = data.answers;
				self.client.__OnInited(userAnswers); //显示用户的答案
				
				$.get(self.basePath+'/answer/'+self.userExamId,{},function(data){			
					if(data&&data.success){
						var paperAnswers = data.answers;
						self.client.__ShowUserAnswerRightStatus(paperAnswers); 
						if(self.allowSeeAnswer){  //显示正确答案
							self.client.__ShowAnswerAndHint(paperAnswers); //显示正确答案和提示
						}
					}else{
						self.Message('获取试卷答案失败，请重试！', 'err');
					}			
				},'json');
				
			}else{
				self.Message('获取您的答案失败，请重试！', 'err');
			}			
		},'json');
	};	
	ExamObj.prototype.CloseDialog=function(){
		if(this.dialog){
			this.dialog.hide();
		}
	};
	ExamObj.prototype.Message=function(msg,flag){
		var self=this;
		if(!self.dialog){
			self.dialog=$('<div class="ui-popup-tip"></div>');
			$('#ui_wrapper').append(self.dialog);
			self.dialog.css('right','20px').css('top','50px');
		}
		var wrapper=$('<div class="ui-info"></div>');
		self.dialog.empty().append(wrapper);
		if($.type(msg)=='string'){
			wrapper.append('<p>'+msg+'</p>');
		}else{
			wrapper.append($(msg));
		}
		var actionBar=$('<div class="ui-action-bar"></div>');
		if(arguments.length>2){
			var btns=arguments[2];
			if($.isArray(btns)){
				var len=btns.length,i;
				for(i=0;i<len;i++){
					var b=btns[i],btn=$('<button>'+b.label+'</button>');
					btn.on('click',b.func);actionBar.append(btn);
				}
			}
		}else{
			var c=$('<button>知道了</button>');
			actionBar.append(c);c.on('click',function(){self.CloseDialog();});
		}
		wrapper.append(actionBar);
		self.dialog.show();
	};	
	win.ExamObj=ExamObj;
})(jQuery,window);